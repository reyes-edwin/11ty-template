<!doctype html>
<html lang="en">
  <head>
    <meta charset="utf-8">
    <meta name="viewport" content="width=device-width, initial-scale=1.0">
    <title>Using The Javascript Fetch API To Get Data.</title>
    <meta name="description" content="This is a post on using js fetch api.">
    <link rel="stylesheet" href="/css/index.css">
    <link rel="stylesheet" href="/css/prism-base16-monokai.dark.css">
    <link rel="alternate" href="/feed/feed.xml" type="application/atom+xml" title="Edwin Reyes Blog">
    <link rel="alternate" href="/feed/feed.json" type="application/json" title="Edwin Reyes Blog">
  </head>
  <body>
    <header>
      <h1 class="home"><a href="/">Edwin Reyes Blog</a></h1>
      <ul class="nav">
        <li class="nav-item"><a href="/">Home</a></li>
        <li class="nav-item"><a href="/posts/">Archive</a></li>
        <li class="nav-item"><a href="/about/">About Me</a></li>
      </ul>
    </header>

    <main class="tmpl-post">

      <h1>Using The Javascript Fetch API To Get Data.</h1>

<time datetime="2018-07-04">04 Jul 2018</time><a href="/tags/js/" class="post-tag">js</a><a href="/tags/api/" class="post-tag">API</a><a href="/tags/ip/" class="post-tag">ip</a>

<p>Today, I'm going to walk you through how to wire up some data up to a Wikipedia-query tag so that when your IP address changes, your location will change, and so will the Wikipedia article.</p>
<h2 id="getting-started" tabindex="-1">Getting Started <a class="direct-link" href="#getting-started" aria-hidden="true">#</a></h2>
<p>For this lab we utilize <a href="https://freegeoip.app/">GeoIP</a> to retrieve our <code>lat</code>, <code>long</code>, <code>city</code>, and <code>state</code>. Here's how our constructor looks.</p>
<pre class="language-js"><code class="language-js">  <span class="token function">constructor</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token keyword">super</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>locationEndpoint <span class="token operator">=</span> <span class="token string">'https://freegeoip.app/json/'</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>long <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>lat <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>    <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> <span class="token keyword">null</span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span></code></pre>
<p>Next, we set the properties that we later use to populate our data. Here we return our lat and long as integers and our city and state as strings.</p>
<pre class="language-js"><code class="language-js">  <span class="token keyword">static</span> <span class="token keyword">get</span> <span class="token function">properties</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">return</span> <span class="token punctuation">{</span><br>    <span class="token literal-property property">long</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Number <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">lat</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> Number <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">city</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span><br>    <span class="token literal-property property">state</span><span class="token operator">:</span> <span class="token punctuation">{</span> <span class="token literal-property property">type</span><span class="token operator">:</span> String <span class="token punctuation">}</span><span class="token punctuation">,</span><br>  <span class="token punctuation">}</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<h2 id="fetching-api" tabindex="-1">Fetching API <a class="direct-link" href="#fetching-api" aria-hidden="true">#</a></h2>
<p>Before fetching the data from our API, let's talk about what fetch is. Fetch API is an interface that allows you to make HTTP requests to servers from web browsers. We utilize the fetch to retrieve our location based on our IP address in this lab. See how we utilize fetch in our lab.</p>
<pre class="language-js"><code class="language-js"> <span class="token keyword">async</span> <span class="token function">getGEOIPData</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>  <span class="token keyword">const</span> IPClass <span class="token operator">=</span> <span class="token keyword">new</span> <span class="token class-name">UserIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">const</span> userIPData <span class="token operator">=</span> <span class="token keyword">await</span> IPClass<span class="token punctuation">.</span><span class="token function">updateUserIP</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>  <span class="token keyword">return</span> <span class="token function">fetch</span><span class="token punctuation">(</span><span class="token keyword">this</span><span class="token punctuation">.</span>locationEndpoint <span class="token operator">+</span> userIPData<span class="token punctuation">.</span>ip<span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">resp</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token keyword">if</span> <span class="token punctuation">(</span>resp<span class="token punctuation">.</span>ok<span class="token punctuation">)</span> <span class="token punctuation">{</span><br>        <span class="token keyword">return</span> resp<span class="token punctuation">.</span><span class="token function">json</span><span class="token punctuation">(</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br>      <span class="token punctuation">}</span><br>      <span class="token keyword">return</span> <span class="token boolean">false</span><span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><br>    <span class="token punctuation">.</span><span class="token function">then</span><span class="token punctuation">(</span><span class="token parameter">data</span> <span class="token operator">=></span> <span class="token punctuation">{</span><br>      <span class="token comment">// console.log(data);</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>long <span class="token operator">=</span> data<span class="token punctuation">.</span>longitude<span class="token punctuation">;</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>lat <span class="token operator">=</span> data<span class="token punctuation">.</span>latitude<span class="token punctuation">;</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>city <span class="token operator">=</span> data<span class="token punctuation">.</span>city<span class="token punctuation">;</span><br>      <span class="token keyword">this</span><span class="token punctuation">.</span>state <span class="token operator">=</span> data<span class="token punctuation">.</span>region_name<span class="token punctuation">;</span><br><br>      <span class="token keyword">return</span> data<span class="token punctuation">;</span><br>    <span class="token punctuation">}</span><span class="token punctuation">)</span><span class="token punctuation">;</span><br><span class="token punctuation">}</span></code></pre>
<p>In this code block, using the URL we set to locationEndpoint we were able to fetch our location based on our IP address. We used fetch to make an HTTP request to the server holding the API, then if the response was &quot;ok,&quot; we will return the API call as a <a href="https://www.json.org/json-en.html">JSON</a>. Here's what the API response should look like.</p>
<pre class="language-js"><code class="language-js"><span class="token punctuation">{</span><br><span class="token string-property property">"ip"</span><span class="token operator">:</span> <span class="token string">"102.16.28.100"</span><span class="token punctuation">,</span><br><span class="token string-property property">"country_code"</span><span class="token operator">:</span> <span class="token string">"US"</span><span class="token punctuation">,</span><br><span class="token string-property property">"country_name"</span><span class="token operator">:</span> <span class="token string">"United States"</span><span class="token punctuation">,</span><br><span class="token string-property property">"region_code"</span><span class="token operator">:</span> <span class="token string">"PA"</span><span class="token punctuation">,</span><br><span class="token string-property property">"region_name"</span><span class="token operator">:</span> <span class="token string">"Pennsylvania"</span><span class="token punctuation">,</span><br><span class="token string-property property">"city"</span><span class="token operator">:</span> <span class="token string">"State College"</span><span class="token punctuation">,</span><br><span class="token string-property property">"zip_code"</span><span class="token operator">:</span> <span class="token string">"16802"</span><span class="token punctuation">,</span><br><span class="token string-property property">"time_zone"</span><span class="token operator">:</span> <span class="token string">"America/New_York"</span><span class="token punctuation">,</span><br><span class="token string-property property">"latitude"</span><span class="token operator">:</span> <span class="token number">40</span><span class="token punctuation">,</span><br><span class="token string-property property">"longitude"</span><span class="token operator">:</span> <span class="token operator">-</span><span class="token number">77</span><span class="token punctuation">,</span><br><span class="token string-property property">"metro_code"</span><span class="token operator">:</span> <span class="token number">574</span><br><span class="token punctuation">}</span></code></pre>
<p>We then set our properties <code>lat</code>, <code>long</code>, <code>city</code>, and <code>state</code> to the variables the API returns to access the data. In this case, we only need the latitude, longitude, city, and region_name, which means the state you are in.</p>
<h2 id="render()" tabindex="-1">Render() <a class="direct-link" href="#render()" aria-hidden="true">#</a></h2>
<pre class="language-js"><code class="language-js"><span class="token function">render</span><span class="token punctuation">(</span><span class="token punctuation">)</span> <span class="token punctuation">{</span><br>    <span class="token comment">// this function runs every time a properties() declared variable changes</span><br>    <span class="token comment">// this means you can make new variables and then bind them this way if you like</span><br>    <span class="token keyword">const</span> url <span class="token operator">=</span> <span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">https://maps.google.com/maps?q=</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lat<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>long<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">&amp;t=&amp;z=15&amp;ie=UTF8&amp;iwloc=&amp;output=embed</span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>    <span class="token keyword">return</span> html<span class="token template-string"><span class="token template-punctuation string">`</span><span class="token string">&lt;iframe title="Where you are" src="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span>url<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/iframe><br>      &lt;br /><br>      &lt;link href="https://www.google.com/maps/@</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>lat<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>long<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">,14z" /><br>      &lt;wikipedia-query search="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">, </span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/wikipedia-query><br>      &lt;wikipedia-query search="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>city<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/wikipedia-query><br>      &lt;wikipedia-query search="</span><span class="token interpolation"><span class="token interpolation-punctuation punctuation">${</span><span class="token keyword">this</span><span class="token punctuation">.</span>state<span class="token interpolation-punctuation punctuation">}</span></span><span class="token string">">&lt;/wikipedia-query> </span><span class="token template-punctuation string">`</span></span><span class="token punctuation">;</span><br>  <span class="token punctuation">}</span></code></pre>
<p>This method is invoked on each update to perform rendering tasks. This method returns any value renderable by lit-HTML's elements. We pass the <code>lat</code> and <code>long</code> properties to get the Iframe working. Whenever these properties are changed, lit render the information and updates.</p>
<h2 id="wiring-the-wikipedia-tags" tabindex="-1">Wiring The Wikipedia Tags <a class="direct-link" href="#wiring-the-wikipedia-tags" aria-hidden="true">#</a></h2>
<ol>
<li>
<p>Create an HTML link that sits below the iframe that links to the location on google maps.</p>
</li>
<li>
<p>Pass the <code>lat</code>, and <code>long</code> properties.</p>
</li>
<li>
<p>Next run npm <code>install @lrnwebcomponents/wikipedia-query</code></p>
</li>
<li>
<p>In order to use the we must import the tag at the top of your file to use it import '@lrnwebcomponents/wikipedia-query/wikipedia-query.js;'</p>
</li>
<li>
<p>Next, in our render function add in the wikipedia tags. <a href="https://en.wikipedia.org/w/api.php">Wikipedia's API is documented</a></p>
</li>
<li>
<p>The search property takes <code>${this.city}</code>, <code>${this.state}</code> and the comma then a space to ensure the tags work properly.</p>
</li>
</ol>
<p>Based on your location the Wikipedia tag will display information of your state and city.</p>
<p>Now you have successfully fetch an API to wire Wikipedia tags. Way to go!</p>
<p>To view the complete project <a href="https://github.com/reyes-edwin/ip-project/blob/master/src/LocationFromIP.js">click here</a>.</p>
<h1 id="resources" tabindex="-1">Resources <a class="direct-link" href="#resources" aria-hidden="true">#</a></h1>
<ol>
<li><a href="https://www.npmjs.com/package/@lrnwebcomponents/wikipedia-query">wikipedia-query</a></li>
<li><a href="https://freegeoip.app/">GeoIP</a></li>
<li><a href="https://developer.mozilla.org/en-US/docs/Web/API/Fetch_API/Using_Fetch">Fecth API</a></li>
</ol>

<hr>
<ul><li>Next: <a href="/posts/firstpost/">How To Build A Basic Web Component.</a></li>
</ul>

    </main>

    <footer></footer>

    <!-- Current page: /posts/secondpost/ -->
  </body>
</html>
